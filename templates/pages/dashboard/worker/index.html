{% extends "layouts/dashboard_base.html" %}
{% from "components/dashboard/kpi_card_v2.html" import kpi_card %}
{% from "components/dashboard/widgets/worker_workflow_bar.html" import worker_workflow_bar with context %}
{% from "components/dashboard/widgets/emissions_breakdown_chart.html" import emissions_breakdown_chart %}
{% from "components/dashboard/widgets/worker_action_center.html" import worker_action_center %}
{% from "components/dashboard/widgets/recent_uploads_table.html" import recent_uploads_table %}

{% block title %}Worker Dashboard{% endblock %}

{% block dashboard_content %}

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div class="mb-6">
    {% for category, message in messages %}
    <div class="p-4 mb-4 text-sm rounded-lg {% if category == 'error' %}bg-red-50 text-red-800{% else %}bg-green-50 text-green-800{% endif %}"
        role="alert">
        <span class="font-medium">{{ message }}</span>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endwith %}

<div class="max-w-[1400px] mx-auto flex flex-col gap-6">
    <!-- Filters & Workflow Bar -->
    {{ worker_workflow_bar() }}

    <!-- KPI Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        {{ kpi_card('Total Carbon Footprint', kpis.footprint, 'tCO2e', kpis.footprint_change, 'down', 'cloud') }}
        {{ kpi_card('Est. CBAM Liability', kpis.liability, '', kpis.liability_change, 'up', 'euro') }}
        {{ kpi_card('Carbon Cost Exposure', kpis.exposure, '', kpis.exposure_change, 'neutral',
        'account_balance_wallet') }}
        {{ kpi_card('Data Completeness', kpis.completeness, '', '', '', 'pie_chart') }}
    </div>

    <!-- Charts & Actions Section -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-auto min-h-[400px]">
        {{ emissions_breakdown_chart() }}
        {{ worker_action_center(alerts) }}
    </div>

    <!-- Recent Activity Table -->
    {{ recent_uploads_table(my_activities) }}
</div>

{% endblock %}