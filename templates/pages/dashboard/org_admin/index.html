{% extends "layouts/dashboard_base.html" %}
{% from "components/dashboard/kpi_card_v2.html" import kpi_card %}
{% from "components/dashboard/widgets/filters_bar.html" import filters_bar %}
{% from "components/dashboard/widgets/scope_chart.html" import scope_chart %}
{% from "components/dashboard/widgets/action_center.html" import action_center %}
{% from "components/dashboard/widgets/pending_validation_table.html" import pending_validation_table %}
{% from "components/dashboard/widgets/recent_activity_table.html" import recent_activity_table %}

{% block title %}Organization Admin Dashboard{% endblock %}

{% block dashboard_content %}

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div class="mb-6">
    {% for category, message in messages %}
    <div class="p-4 mb-4 text-sm rounded-lg {% if category == 'error' %}bg-red-50 text-red-800{% else %}bg-green-50 text-green-800{% endif %}"
        role="alert">
        <span class="font-medium">{{ message }}</span>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endwith %}

<div class="max-w-[1400px] mx-auto flex flex-col gap-6">
    {{ filters_bar(organization) }}

    <!-- KPI Grid - Carbon Overview -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        {{ kpi_card('Total Emissions', kpis.total_emissions, 'tCO2e', kpis.total_emissions_change, 'down', 'cloud') }}
        {{ kpi_card('Scope 1 Emissions', kpis.scope1, 'tCO2e', kpis.scope1_change, 'down', 'local_fire_department') }}
        {{ kpi_card('Scope 2 Emissions', kpis.scope2, 'tCO2e', kpis.scope2_change, 'up', 'bolt') }}
        {{ kpi_card('Scope 3 Emissions', kpis.scope3, 'tCO2e', kpis.scope3_change, 'down', 'public') }}
    </div>

    <!-- Charts & Actions Section -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-auto min-h-[400px]">
        {{ scope_chart(kpis) }}
        {{ action_center(alerts) }}
    </div>

    {{ pending_validation_table(pending_emissions, kpis) }}

    {{ recent_activity_table(recent_activities) }}
</div>

{% endblock %}