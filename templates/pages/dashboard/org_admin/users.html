{% extends "layouts/dashboard_base.html" %}

{% block title %}Users & Roles - Organization Admin{% endblock %}

{% block dashboard_content %}

<div class="max-w-[1400px] mx-auto flex flex-col gap-6">
    <!-- Header -->
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-bold text-[#111814] dark:text-white">Users & Roles</h1>
            <p class="text-sm text-[#618975] dark:text-[#8baaa0] mt-1">Manage organization members and permissions</p>
        </div>
        <div class="flex gap-3">
            <button onclick="alert('User invitation feature coming soon!')"
                class="h-10 px-4 rounded-lg bg-primary hover:bg-primary/90 text-white font-medium text-sm transition-colors flex items-center gap-2">
                <span class="material-symbols-outlined" style="font-size: 18px;">person_add</span>
                <span>Invite User</span>
            </button>
            <button onclick="alert('Role management feature coming soon!')"
                class="h-10 px-4 rounded-lg border border-[#dbe6e0] dark:border-[#3d5348] hover:bg-[#f0f4f2] dark:hover:bg-[#23352c] text-[#111814] dark:text-white font-medium text-sm transition-colors flex items-center gap-2">
                <span class="material-symbols-outlined" style="font-size: 18px;">admin_panel_settings</span>
                <span>Manage Roles</span>
            </button>
        </div>
    </div>

    <!-- Users Table -->
    <div
        class="bg-white dark:bg-[#1a2c24] rounded-xl border border-[#e5e7eb] dark:border-[#2a4035] shadow-sm overflow-hidden">
        <div class="p-6 border-b border-[#f0f4f2] dark:border-[#2a4035]">
            <h3 class="text-lg font-bold text-[#111814] dark:text-white">Organization Members</h3>
            <p class="text-sm text-[#618975] dark:text-[#8baaa0] mt-1">{{ users|length }} active users</p>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-left">
                <thead class="bg-[#f9fafb] dark:bg-[#23352c] border-b border-[#e5e7eb] dark:border-[#3d5348]">
                    <tr>
                        <th
                            class="px-6 py-4 text-xs font-semibold text-[#618975] dark:text-[#8baaa0] uppercase tracking-wider">
                            User</th>
                        <th
                            class="px-6 py-4 text-xs font-semibold text-[#618975] dark:text-[#8baaa0] uppercase tracking-wider">
                            Email</th>
                        <th
                            class="px-6 py-4 text-xs font-semibold text-[#618975] dark:text-[#8baaa0] uppercase tracking-wider">
                            Role</th>
                        <th
                            class="px-6 py-4 text-xs font-semibold text-[#618975] dark:text-[#8baaa0] uppercase tracking-wider">
                            Status</th>
                        <th
                            class="px-6 py-4 text-xs font-semibold text-[#618975] dark:text-[#8baaa0] uppercase tracking-wider text-right">
                            Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-[#f0f4f2] dark:divide-[#2a4035]">
                    {% for user_item in users %}
                    <tr class="hover:bg-[#f9fafb] dark:hover:bg-[#23352c] transition-colors">
                        <td class="px-6 py-4">
                            <div class="flex items-center gap-3">
                                <div
                                    class="size-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold">
                                    {{ user_item.email[0]|upper }}
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-[#111814] dark:text-white">{{
                                        user_item.email.split('@')[0]|title }}</p>
                                    <p class="text-xs text-[#618975] dark:text-[#8baaa0]">Member since {{
                                        user_item.created_at.strftime('%b %Y') }}</p>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-sm text-[#618975] dark:text-[#8baaa0]">{{ user_item.email }}</td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium 
                                {% if user_item.role.value == 'org_admin' %}bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400
                                {% elif user_item.role.value == 'worker' %}bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400
                                {% elif user_item.role.value == 'auditor' %}bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400
                                {% else %}bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %}">
                                {{ user_item.role.value|replace('_', ' ')|title }}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <span
                                class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400">
                                <div class="size-1.5 rounded-full bg-green-500"></div>Active
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <button
                                class="text-[#618975] dark:text-[#8baaa0] hover:text-[#111814] dark:hover:text-white transition-colors">
                                <span class="material-symbols-outlined" style="font-size: 20px;">more_vert</span>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Auditor Access Section -->
    <div class="bg-white dark:bg-[#1a2c24] rounded-xl border border-[#e5e7eb] dark:border-[#2a4035] shadow-sm p-6">
        <div class="flex justify-between items-start mb-4">
            <div>
                <h3 class="text-lg font-bold text-[#111814] dark:text-white">Auditor Access</h3>
                <p class="text-sm text-[#618975] dark:text-[#8baaa0] mt-1">Delegate external auditors to review your
                    data</p>
            </div>
            <button onclick="alert('Auditor delegation feature coming soon!')"
                class="h-10 px-4 rounded-lg border border-[#dbe6e0] dark:border-[#3d5348] hover:bg-[#f0f4f2] dark:hover:bg-[#23352c] text-[#111814] dark:text-white font-medium text-sm transition-colors flex items-center gap-2">
                <span class="material-symbols-outlined" style="font-size: 18px;">verified_user</span>
                <span>Delegate Auditor</span>
            </button>
        </div>
        <div class="text-center py-8 text-[#618975] dark:text-[#8baaa0]">
            <span class="material-symbols-outlined text-4xl mb-2">shield</span>
            <p class="font-medium">No auditors delegated yet</p>
            <p class="text-sm mt-1">Invite external auditors to review your carbon data</p>
        </div>
    </div>
</div>

{% endblock %}